<template>
  <div>
    <div class="container">
      <div class="o-apps">
        <div class="c-app__tile" data-bg-color="-app-color-1" />
        <div class="c-app__tile" data-bg-color="-app-color-2" />
        <div class="c-app__tile" data-bg-color="-app-color-3" />
        <div class="c-app__tile" data-bg-color="-app-color-4" />
        <div class="c-app__tile" data-bg-color="-app-color-5" />
        <div class="c-app__tile" data-bg-color="-app-color-6" />
      </div>

      <div class="c-app-container">
        <div class="container">
          <div class="c-app-container__inner">
            <div class="c-app-container__header">
              <h1 class="c-app-container__title">
                This is an App
              </h1>
              <button class="c-app-container__dismiss" type="button">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M16 14L2 0L0 2L14 16L0 30L2 32L16 18L30 32L32 30L18 16L32 2L30 0L16 14Z" fill="#ffffff" />
                </svg>
              </button>
            </div>
            <div class="c-app-container__body" />
          </div>
        </div>
      </div>
    </div>

    <div class="c-app__holder">
      <div class="c-app -app-1">
        <h1 class="c-app__title">
          Application 1
        </h1>
        <div class="c-app__body">
          <p><strong>Pellentesque habitant morbi tristique</strong> senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. <em>Aenean ultricies mi vitae est.</em> Mauris placerat eleifend leo. Quisque sit amet est et sapien ullamcorper pharetra. Vestibulum erat wisi, condimentum sed, <code>commodo vitae</code>, ornare sit amet, wisi. Aenean fermentum, elit eget tincidunt condimentum, eros ipsum rutrum orci, sagittis tempus lacus enim ac dui. <a href="#">Donec non enim</a> in turpis pulvinar facilisis. Ut felis.</p>
        </div>
      </div>

      <div class="c-app -app-2">
        <h1 class="c-app__title">
          Application 2
        </h1>
        <div class="c-app__body">
          <p><strong>Pellentesque habitant morbi tristique</strong> senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. <em>Aenean ultricies mi vitae est.</em> Mauris placerat eleifend leo. Quisque sit amet est et sapien ullamcorper pharetra. Vestibulum erat wisi, condimentum sed, <code>commodo vitae</code>, ornare sit amet, wisi. Aenean fermentum, elit eget tincidunt condimentum, eros ipsum rutrum orci, sagittis tempus lacus enim ac dui. <a href="#">Donec non enim</a> in turpis pulvinar facilisis. Ut felis.</p>
        </div>
      </div>

      <div class="c-app -app-3">
        <h1 class="c-app__title">
          Application 3
        </h1>
        <div class="c-app__body">
          <p><strong>Pellentesque habitant morbi tristique</strong> senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. <em>Aenean ultricies mi vitae est.</em> Mauris placerat eleifend leo. Quisque sit amet est et sapien ullamcorper pharetra. Vestibulum erat wisi, condimentum sed, <code>commodo vitae</code>, ornare sit amet, wisi. Aenean fermentum, elit eget tincidunt condimentum, eros ipsum rutrum orci, sagittis tempus lacus enim ac dui. <a href="#">Donec non enim</a> in turpis pulvinar facilisis. Ut felis.</p>
        </div>
      </div>

      <div class="c-app -app-4">
        <h1 class="c-app__title">
          Application 4
        </h1>
        <div class="c-app__body">
          <p><strong>Pellentesque habitant morbi tristique</strong> senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. <em>Aenean ultricies mi vitae est.</em> Mauris placerat eleifend leo. Quisque sit amet est et sapien ullamcorper pharetra. Vestibulum erat wisi, condimentum sed, <code>commodo vitae</code>, ornare sit amet, wisi. Aenean fermentum, elit eget tincidunt condimentum, eros ipsum rutrum orci, sagittis tempus lacus enim ac dui. <a href="#">Donec non enim</a> in turpis pulvinar facilisis. Ut felis.</p>
        </div>
      </div>

      <div class="c-app -app-5">
        <h1 class="c-app__title">
          Application 5
        </h1>
        <div class="c-app__body">
          <p><strong>Pellentesque habitant morbi tristique</strong> senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. <em>Aenean ultricies mi vitae est.</em> Mauris placerat eleifend leo. Quisque sit amet est et sapien ullamcorper pharetra. Vestibulum erat wisi, condimentum sed, <code>commodo vitae</code>, ornare sit amet, wisi. Aenean fermentum, elit eget tincidunt condimentum, eros ipsum rutrum orci, sagittis tempus lacus enim ac dui. <a href="#">Donec non enim</a> in turpis pulvinar facilisis. Ut felis.</p>
        </div>
      </div>

      <div class="c-app -app-6">
        <h1 class="c-app__title">
          Application 6
        </h1>
        <div class="c-app__body">
          <p><strong>Pellentesque habitant morbi tristique</strong> senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. <em>Aenean ultricies mi vitae est.</em> Mauris placerat eleifend leo. Quisque sit amet est et sapien ullamcorper pharetra. Vestibulum erat wisi, condimentum sed, <code>commodo vitae</code>, ornare sit amet, wisi. Aenean fermentum, elit eget tincidunt condimentum, eros ipsum rutrum orci, sagittis tempus lacus enim ac dui. <a href="#">Donec non enim</a> in turpis pulvinar facilisis. Ut felis.</p>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
// const  constiants = [
//   'primary',
//   'secondary',
//   'accent',
//   'neutral',
//   'info',
//   'success',
//   'warning',
//   'error'
// ]
/* eslint-disable camelcase */
onMounted(function () {
  let app_transform = ''

  const $body = document.body
  const $appContainer = document.querySelector('.c-app-container')
  const $appContainer_title = $appContainer.querySelector('.c-app-container__title')
  const $appContainer_body = $appContainer.querySelector('.c-app-container__body')
  const $apps = document.querySelectorAll('.c-app')

  const getApp = function (e) {
    const index = getIndex(e.target)
    const $app = $apps[index]
    const app_title = $app.querySelector('.c-app__title').textContent
    const app_body = $app.querySelector('.c-app__body').innerHTML

    $appContainer_title.innerHTML = app_title
    $appContainer_body.innerHTML = app_body
    $appContainer.setAttribute('data-bg-color', e.target.getAttribute('data-bg-color'))

    openApp(e)
  }

  const openApp = function (e) {
    const app_bounding_rect = $appContainer.getBoundingClientRect()
    const tile_bounding_rect = e.target.getBoundingClientRect()
    const translateX = tile_bounding_rect.left + 'px'
    const translateY = tile_bounding_rect.top + 'px'
    const scaleX = tile_bounding_rect.width / app_bounding_rect.width
    const scaleY = tile_bounding_rect.height / app_bounding_rect.height

    app_transform = 'translate3d(' + translateX + ',' + translateY + ',0) scale(' + scaleX + ', ' + scaleY + ')'
    $appContainer.style.transform = app_transform
    const _ = document.body.offsetWidth // force reflow
    $body.classList.add('-app-open')
    $appContainer.style.transform = 'translate3d(0,0,0) scale(1)'
  }

  const closeApp = function (e) {
    $appContainer.addEventListener('transitionend', resetApp, false)
    $appContainer.style.transform = app_transform
    $body.classList.add('-app-close')
    $body.classList.remove('-app-open')
  }

  const resetApp = function (e) {
    if (e.target === $appContainer) {
      $body.classList.remove('-app-close')
      $appContainer.removeAttribute('style')
      $appContainer.removeEventListener('transitionend', resetApp)
    }
  }

  document.addEventListener('click', function (e) {
    const matches = e.target.matches('.c-app__tile')
    if (matches) {
      getApp(e)
    }
  }, false)

  document.addEventListener('click', function (e) {
    const matches = e.target.matches('.c-app-container__dismiss')
    if (matches) {
      closeApp(e)
    }
  }, false)

  const getIndex = function (node) {
    const children = node.parentNode.childNodes
    let num = 0
    for (let i = 0; i < children.length; i++) {
      if (children[i] === node) { return num }
      if (children[i].nodeType === 1) { num++ }
    }
    return -1
  }
})
</script>

<style scoped lang="scss">
body{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}

$colors: (
    'app-1': rgba(56, 145, 166, 1),
    'app-2': rgba(76, 91, 92, 1),
    'app-3': #fde74c,
    'app-4': rgba(219, 84, 97, 1),
    'app-5': rgba(227, 101, 91, 1),
    'app-6': #9381ff,
);

@for $i from 1 through length($colors){
  $color : nth($colors, $i);

  [data-bg-color="-app-color-#{$i}"]{
    background-color: #{nth($color,2)};
  }
}

.container{
  margin:0 auto;
  max-width:768px;
  width:100%;
  position:relative;
  justify-content:center;
  display:flex;
}

.o-apps{
  display:flex;
  margin-bottom:-30px;
  width:390px;
  flex-wrap:wrap;
  transform:scale(1);
  transition: transform .3s ease-in-out;

  > *{
    margin:0 15px 30px;
  }

  .-app-open &{
    transform:scale(.8);
  }
}

.c-app__holder{
  display:none;
}

.c-app__tile{
  width:100px;
  height:100px;
  cursor:pointer;
  border-radius:4px;
}

.c-app-container{
  visibility:hidden;
  overflow:hidden;
  position:fixed;
  top:0;
  left:0;
  transform-origin:top left;
  width:100%;
  min-height:100vh;
  /*
  &__content{
    background:red;
    min-height:100vh;
    transition:opacity .15s linear 0s;

    .-app-open &{
      opacity:1;
    }
  }
  */

  &__inner{
    color:#fff;
    padding:50px;
    opacity:0;
    transition:opacity .15s linear 0s;

    .-app-open &{
      opacity:1;
      transition:opacity .15s linear 0.15s;
    }
  }

  &__header{
    display:flex;
    justify-content:space-between;
    padding:24px 0;
  }

  &__dismiss{
    font-size:24px;

    > * {
       pointer-events: none;
    }

  }

  .-app-open &{
    visibility:visible;
    transition: transform .3s ease-in-out 0s, visibility 0s linear 0s;
  }

  .-app-close &{
    visibility:hidden;
    transition: transform .3s ease-in-out 0s, visibility 0s linear .3s;
  }
}
</style>
